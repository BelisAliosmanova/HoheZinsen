<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Interest Rate Offers</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- SortableJS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <script>
        // Toggle "Mehr Info" visibility
        function toggleMoreInfo(id) {
            const section = document.getElementById('more-' + id);
            if (section) section.classList.toggle('d-none');
        }

        // Column reordering
        window.addEventListener("DOMContentLoaded", () => {
            const headerRow = document.getElementById("column-header-row");

            new Sortable(headerRow, {
                animation: 150,
                ghostClass: "bg-warning",
                onEnd: function () {
                    const newOrder = Array.from(headerRow.children).map(th => th.dataset.key);
                    fetch("/api/column-order", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(newOrder)
                    }).then(() => location.reload());
                }
            });
        });
    </script>
</head>
<body class="bg-light">
<div class="container py-5">
    <h2 class="mb-4">Interest Rate Offers</h2>

    <div class="table-responsive">
        <table class="table table-bordered table-striped text-center align-middle">
            <thead class="table-dark">
            <tr id="column-header-row">
                <th th:each="key : ${columnOrder}"
                    th:data-key="${key}"
                    th:text="${columnLabels.get(key)}"
                    style="cursor: grab;"></th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="rate : ${interestRates}">
                <td th:each="key : ${columnOrder}">
                        <span th:switch="${key}">
                            <span th:case="'interestRate'" th:text="${rate.interestRate}"></span>
                            <span th:case="'duration'" th:text="${rate.duration}"></span>
                            <span th:case="'provider'" th:text="${rate.provider}"></span>
                            <span th:case="'paymentFrequency'" th:text="${rate.paymentFrequency}"></span>
                            <span th:case="'interestType'" th:text="${rate.interestType}"></span>
                            <span th:case="'actions'">
                                <button class="btn btn-outline-info btn-sm"
                                        th:onclick="'toggleMoreInfo(' + ${rate.id} + ')'">Mehr Info</button>
                                <button class="btn btn-success btn-sm">Zum Angebot</button>
                            </span>
                        </span>
                </td>
            </tr>

            <!-- More Info Section (per row) -->
            <tr th:each="rate : ${interestRates}">
                <td th:colspan="${#lists.size(columnOrder)}">
                    <div th:id="'more-' + ${rate.id}" class="card p-3 mt-2 d-none bg-white shadow-sm">
                        <h5 th:text="${rate.moreInfo?.tableTitle}">Mini Table Title</h5>
                        <table class="table table-sm" th:if="${rate.moreInfo != null}">
                            <thead>
                            <tr>
                                <th>Label</th>
                                <th>Description</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="row : ${rate.moreInfo.miniTableRows}">
                                <td th:text="${row.label}"></td>
                                <td th:text="${row.description}"></td>
                            </tr>
                            </tbody>
                        </table>
                        <div class="mt-3">
                            <h6 th:text="${rate.moreInfo?.textTitle}">Text Title</h6>
                            <p th:text="${rate.moreInfo?.textDescription}">Description goes here...</p>
                        </div>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>
